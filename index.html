<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="style.css" />
		
		<script type="text/javascript">
			window.onload = function(){
				
				var productList, widgetSize, mainItem, mainItemPayCond, itemRecommended;
				productContainer = document.getElementById("product-container");
				recommendedproductContainer = document.getElementById("recommended-products");

				function myFunction(jFile){
					var myObj = JSON.parse(jFile.responseText);
					
					//Storing Json values in the variables to ease the process of consulting it.
					productList = myObj[0].data;
					widgetSize = productList.widget.size;
					mainItem = productList.item;
					itemRecommended = productList.recommendation;
					mainItemPayCond = mainItem.productInfo.paymentConditions
					
					//Truncating text with ellipsis
					function truncateString(textElement){
						if(textElement.length > 100){
							return textElement.substring(0,100) + "...";
							
						}else{
							return textElement;
						}
					}
					
					//Function responsible for defining obj's value and responsible for  creating the HTML code
					function builderBlock(){
						var formattedText = truncateString(mainItem.name);
						var createStructure = "<h3>VocÃª visitou:</h3><div id='" + mainItem.businessId + "'><img src='https:" + 
						mainItem.imageName +"' alt='" + mainItem.businessId + "' class='productImage' /><p id='product-description'>" +
						formattedText + "</p><p id='product-prce'> Por: " + mainItem.price + "</p><p id='product-in-instalments'>" +
						mainItemPayCond + "</p></div>";
						
						//Exihibiting the content on the screen
						productContainer.innerHTML = createStructure;
					};
					builderBlock();
					
					function builderBlockRec(){
					var formattedTextRed;
					var createStructureRec = "<h3>e talvez se interesse por:</h3>";
						for(var i=0; i<itemRecommended.length; i++){
							formattedTextRed = truncateString(itemRecommended[i].name);
							createStructureRec += "<div class='singularRecItem'><img src='https:" + itemRecommended[i].imageName +"' alt='" +
							itemRecommended[i].businessId +	"' class='productImage' /><div id='product-description'>" + formattedTextRed +
							"</div><div id='product-prce'> Por: " + itemRecommended[i].price + "</div><div id='product-in-instalments'>" +
							itemRecommended[i].productInfo.paymentConditions + "</div></div>";
						}
						recommendedproductContainer.innerHTML = createStructureRec;
					};
					builderBlockRec();
				};
				
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function(){
					if(this.readyState == 4 && this.status == 200){
						myFunction(this);
					}
				}
				xhttp.open("GET", "https://raw.githubusercontent.com/johnnascimento/itelios-frontend-challenge/master/products.json", true);
				xhttp.send();
			}
		</script>
		
	</head>
	
	<body>
		<div class="wrapping-products-container" id="">
			<div class="productVisited" id="product-container">
			</div>
			<div class="productRecommended" id="recommended-products">
			</div>
		</div>
	</body>
	
	<!--<script type="text/javascript" src="siema.min.js"></script>
	<script type="text/javascript">
			new Siema({
				perPage: 3
			});
	</script>-->
	
</html>
